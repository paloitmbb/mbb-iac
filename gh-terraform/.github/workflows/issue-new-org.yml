name: "Handle New Org Request"

on:
  issues:
    types: [opened]

jobs:
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # CI: Update YAML + Commit
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  update-yaml:
    if: startsWith(github.event.issue.title, '[New Org]')
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: write
    outputs:
      org_name: ${{ steps.parse.outputs.issueparser_org_name }}
      enterprise_slug: ${{ steps.parse.outputs.issueparser_enterprise_slug }}
      display_name: ${{ steps.parse.outputs.issueparser_display_name }}
      billing_email: ${{ steps.parse.outputs.issueparser_billing_email }}
      admin_logins: ${{ steps.parse.outputs.issueparser_admin_logins }}
      environment: ${{ steps.parse.outputs.issueparser_environment }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Parse Issue Form
        id: parse
        uses: stefanbuck/github-issue-parser@v3
        with:
          template-path: .github/ISSUE_TEMPLATE/new-org-request.yml

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install PyYAML
        run: pip install pyyaml

      - name: Update organizations.yaml
        run: |
          python3 scripts/add_org_to_yaml.py \
            --name "${{ steps.parse.outputs.issueparser_org_name }}" \
            --display-name "${{ steps.parse.outputs.issueparser_display_name }}" \
            --description "${{ steps.parse.outputs.issueparser_org_description }}" \
            --billing-email "${{ steps.parse.outputs.issueparser_billing_email }}" \
            --admin-logins "${{ steps.parse.outputs.issueparser_admin_logins }}" \
            --company "${{ steps.parse.outputs.issueparser_company }}" \
            --blog "${{ steps.parse.outputs.issueparser_blog }}" \
            --email "${{ steps.parse.outputs.issueparser_org_email }}" \
            --location "${{ steps.parse.outputs.issueparser_location }}" \
            --default-repo-permission "${{ steps.parse.outputs.issueparser_default_repo_permission }}" \
            --members-can-create-repos "${{ steps.parse.outputs.issueparser_members_can_create_repos }}" \
            --environment "${{ steps.parse.outputs.issueparser_environment }}" \
            --security-features "${{ steps.parse.outputs.issueparser_security_features }}"

      - name: Commit and Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add data/organizations.yaml
          git commit -m "feat: add organization ${{ steps.parse.outputs.issueparser_org_name }}"
          git push

      - name: Comment on Issue
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ‚úÖ **YAML Updated**

            | Field | Value |
            |-------|-------|
            | **Enterprise** | `${{ steps.parse.outputs.issueparser_enterprise_slug }}` |
            | **Organization** | `${{ steps.parse.outputs.issueparser_org_name }}` |
            | **Display Name** | `${{ steps.parse.outputs.issueparser_display_name }}` |
            | **Billing Email** | `${{ steps.parse.outputs.issueparser_billing_email }}` |
            | **Admins** | `${{ steps.parse.outputs.issueparser_admin_logins }}` |
            | **Environment** | `${{ steps.parse.outputs.issueparser_environment }}` |

            üîç Checkov security scan will run next, followed by Terraform plan.

      - name: Label as In Progress
        run: |
          gh label create "in-progress" --color "FBCA04" --description "Request is being processed" --force 2>/dev/null || true
          gh issue edit ${{ github.event.issue.number }} --add-label "in-progress"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # CI: Security Scanning (Checkov)
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  checkov-scan:
    needs: update-yaml
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    strategy:
      matrix:
        environment: [sit, staging, prod]

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.repository.default_branch }}

      - name: Pull latest changes
        run: git pull origin ${{ github.event.repository.default_branch }}

      - name: Run Checkov Scan
        id: checkov
        uses: bridgecrewio/checkov-action@v12
        with:
          directory: environments/${{ matrix.environment }}
          framework: terraform
          output_format: cli,sarif
          output_file_path: console,checkov-${{ matrix.environment }}.sarif
          soft_fail: true
          skip_check: CKV_GIT_1,CKV_GIT_5

      - name: Comment Checkov Result on Issue
        if: always()
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ### üîç Checkov Scan ‚Äî `${{ matrix.environment }}` ${{ steps.checkov.outcome == 'success' && '‚úÖ' || '‚ö†Ô∏è' }}

            Security scan completed for `environments/${{ matrix.environment }}`.
            Status: **${{ steps.checkov.outcome }}**

  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # CI: Terraform Plan (all environments)
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  terraform-plan:
    needs: [update-yaml, checkov-scan]
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    strategy:
      matrix:
        environment: [sit, staging, prod]

    steps:
      - name: Fail if Enterprise Slug is empty
        run: |
          SLUG="${{ needs.update-yaml.outputs.enterprise_slug }}"
          echo "Enterprise slug from issue template: [$SLUG]"
          if [ -z "$SLUG" ]; then
            echo "::error::Enterprise slug is empty! Check issue template parsing."
            exit 1
          fi

      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.repository.default_branch }}

      - name: Pull latest changes
        run: git pull origin ${{ github.event.repository.default_branch }}

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.14.0

      - name: Terraform Init
        working-directory: environments/${{ matrix.environment }}
        run: terraform init
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT_TOKEN }}
          TF_HTTP_PASSWORD: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_github_token: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_enterprise_slug: ${{ needs.update-yaml.outputs.enterprise_slug }}
          TF_VAR_organization: ${{ needs.update-yaml.outputs.enterprise_slug }}
          GITHUB_OWNER: ${{ needs.update-yaml.outputs.enterprise_slug }}

      - name: Terraform Validate
        working-directory: environments/${{ matrix.environment }}
        run: terraform validate
        env:
          TF_VAR_github_token: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_enterprise_slug: ${{ needs.update-yaml.outputs.enterprise_slug }}
          TF_VAR_organization: ${{ needs.update-yaml.outputs.enterprise_slug }}
          GITHUB_OWNER: ${{ needs.update-yaml.outputs.enterprise_slug }}

      - name: Terraform Plan
        id: plan
        working-directory: environments/${{ matrix.environment }}
        run: |
          terraform plan -no-color -out=tfplan 2>&1 | tee plan_output.txt
          echo "exit_code=$?" >> $GITHUB_OUTPUT
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT_TOKEN }}
          TF_HTTP_PASSWORD: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_github_token: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_enterprise_slug: ${{ needs.update-yaml.outputs.enterprise_slug }}
          TF_VAR_organization: ${{ needs.update-yaml.outputs.enterprise_slug }}
          GITHUB_OWNER: ${{ needs.update-yaml.outputs.enterprise_slug }}
        continue-on-error: true

      - name: Comment Plan on Issue
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ### Terraform Plan ‚Äî `${{ matrix.environment }}` ${{ steps.plan.outcome == 'success' && '‚úÖ' || '‚ùå' }}

            <details><summary>Show Plan</summary>

            ```
            ${{ steps.plan.outputs.stdout }}
            ```

            </details>

      - name: Fail if Plan Failed
        if: steps.plan.outcome == 'failure'
        run: exit 1

  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # CD: Terraform Apply ‚Äî SIT
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  terraform-apply-sit:
    needs: [update-yaml, terraform-plan]
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    environment:
      name: sit

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.repository.default_branch }}

      - name: Pull latest changes
        run: git pull origin ${{ github.event.repository.default_branch }}

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.14.0

      - name: Terraform Init
        working-directory: environments/sit
        run: terraform init
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT_TOKEN }}
          TF_HTTP_PASSWORD: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_github_token: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_enterprise_slug: ${{ needs.update-yaml.outputs.enterprise_slug }}
          TF_VAR_organization: ${{ needs.update-yaml.outputs.enterprise_slug }}
          GITHUB_OWNER: ${{ needs.update-yaml.outputs.enterprise_slug }}

      - name: Terraform Apply
        working-directory: environments/sit
        run: terraform apply -auto-approve
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT_TOKEN }}
          TF_HTTP_PASSWORD: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_github_token: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_enterprise_slug: ${{ needs.update-yaml.outputs.enterprise_slug }}
          TF_VAR_organization: ${{ needs.update-yaml.outputs.enterprise_slug }}
          GITHUB_OWNER: ${{ needs.update-yaml.outputs.enterprise_slug }}

      - name: Comment Apply Result on Issue
        if: always()
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ### Terraform Apply ‚Äî `sit` ${{ job.status == 'success' && '‚úÖ' || '‚ùå' }}
            Status: **${{ job.status }}**

  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # CD: Terraform Apply ‚Äî Staging
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  terraform-apply-staging:
    needs: [update-yaml, terraform-apply-sit]
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    environment:
      name: staging

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.repository.default_branch }}

      - name: Pull latest changes
        run: git pull origin ${{ github.event.repository.default_branch }}

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.14.0

      - name: Terraform Init
        working-directory: environments/staging
        run: terraform init
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT_TOKEN }}
          TF_HTTP_PASSWORD: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_github_token: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_enterprise_slug: ${{ needs.update-yaml.outputs.enterprise_slug }}
          TF_VAR_organization: ${{ needs.update-yaml.outputs.enterprise_slug }}
          GITHUB_OWNER: ${{ needs.update-yaml.outputs.enterprise_slug }}

      - name: Terraform Apply
        working-directory: environments/staging
        run: terraform apply -auto-approve
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT_TOKEN }}
          TF_HTTP_PASSWORD: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_github_token: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_enterprise_slug: ${{ needs.update-yaml.outputs.enterprise_slug }}
          TF_VAR_organization: ${{ needs.update-yaml.outputs.enterprise_slug }}
          GITHUB_OWNER: ${{ needs.update-yaml.outputs.enterprise_slug }}

      - name: Comment Apply Result on Issue
        if: always()
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ### Terraform Apply ‚Äî `staging` ${{ job.status == 'success' && '‚úÖ' || '‚ùå' }}
            Status: **${{ job.status }}**

  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # CD: Terraform Apply ‚Äî Prod
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  terraform-apply-prod:
    needs: [update-yaml, terraform-apply-staging]
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    environment:
      name: prod

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.repository.default_branch }}

      - name: Pull latest changes
        run: git pull origin ${{ github.event.repository.default_branch }}

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.14.0

      - name: Terraform Init
        working-directory: environments/prod
        run: terraform init
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT_TOKEN }}
          TF_HTTP_PASSWORD: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_github_token: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_enterprise_slug: ${{ needs.update-yaml.outputs.enterprise_slug }}
          TF_VAR_organization: ${{ needs.update-yaml.outputs.enterprise_slug }}
          GITHUB_OWNER: ${{ needs.update-yaml.outputs.enterprise_slug }}

      - name: Terraform Apply
        working-directory: environments/prod
        run: terraform apply -auto-approve
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT_TOKEN }}
          TF_HTTP_PASSWORD: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_github_token: ${{ secrets.GH_PAT_TOKEN }}
          TF_VAR_enterprise_slug: ${{ needs.update-yaml.outputs.enterprise_slug }}
          TF_VAR_organization: ${{ needs.update-yaml.outputs.enterprise_slug }}
          GITHUB_OWNER: ${{ needs.update-yaml.outputs.enterprise_slug }}

      - name: Comment Apply Result on Issue
        if: always()
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ### Terraform Apply ‚Äî `prod` ${{ job.status == 'success' && '‚úÖ' || '‚ùå' }}
            Status: **${{ job.status }}**

  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  # Close Issue on Success
  # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  close-issue:
    needs: [terraform-apply-sit, terraform-apply-staging, terraform-apply-prod]
    if: success()
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
      - name: Label and Close Issue
        run: |
          gh label create "completed" --color "0E8A16" --description "Request completed" --force 2>/dev/null || true
          gh issue edit ${{ github.event.issue.number }} --add-label "completed" --remove-label "in-progress"
          gh issue close ${{ github.event.issue.number }} --comment "‚úÖ Organization has been successfully created in all environments (SIT ‚Üí Staging ‚Üí Prod)."
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_REPO: ${{ github.repository }}
